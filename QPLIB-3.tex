%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%  QPLIB-3.tex
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\section{Library Construction}\label{sec:lib}

In this section we present all the steps performed in order to build the
new library. In \S~\ref{subsec:instColl}, we describe the set of gathered
instances. In \S~\ref{subsec:selection} we present the features used to
classify the instances and we discuss the issues concerning the format of
the instances. Finally, in \S~\ref{subsec:final set}, we describe the
selection process used to filter the instances and we graphically present
the main features of the selected instances.

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Instance Collection}\label{subsec:instColl}

In this section we describe the procedure we adopted to gather the
instances. In January $2014$, we issued an online call for instances
using the main international mailing lists of the mathematical
optimization and numerical analysis communities, reaching in this way
the largest possible set of interested researchers and practitioners.
The call remained open for 10 months, during which we received a large
number of contributions of different nature. The instances we gathered
come both from theoretical studies as well as from real-world
applications.

In addition to spontaneous contribution we analysed the other generic
libraries of instances available  on internet and containing QP
instances. Namely, the libraries from which we gathered instances are
%
\begin{itemize}
 \item the {\tt BARON} library
 \url{http://www.minlp.com/nlp-and-minlp-test-problems};
%
\item the {\tt CUTEst} library
 \url{https://ccpforge.cse.rl.ac.uk/gf/project/cutest/wiki};
%
\item the {\tt GAMS Performance} libraries
 \url{http://www.gamsworld.org/performance/performlib.htm};
%
\item the {\tt MacMINLP} library
 \url{https://wiki.mcs.anl.gov/leyffer/index.php/MacMINLP};
%
\item the {\tt Meszaros} library
 \url{http://www.doc.ic.ac.uk/~im/00README.QP};
%
\item the {\tt MINLP} library
 \url{http://www.gamsworld.org/minlp/minlplib.htm};
%
\item the {\tt POLIP} library
 \url{http://polip.zib.de/pipformat.php}.
\end{itemize}

Other quadratic instances were found in online libraries devoted to
specific QP problems as Max-Cut, Quadratic Assignment, Portfolio
Optimization, and several others.

At the end of this process we gathered more than eight thousand
instances. Three fourths of them contained discrete variables, while
the remaining ones contained only continuous variables. More in details,
we gathered $\approx 1800$ Quadratic Binary Linear (QBL) instances,
$\approx 2000$ Quadratic Continuous Quadratic (QCQ) instances, and
and $\approx 2500$ Quadratic General Quadratic (QGQ) instances. W
also gathered $\approx 1000$ Convex General Convex (CGC) instances. We
gathered relatively fewer Quadratic Binary Quadratic (QBQ), Convex
Continuous Convex (CCC) and Convex Mixed Convex (CMC) instances, i.e.,
$\approx 150$ instances, $\approx 200$ instances and $\approx 200$
instances respectively. Finally, we gathered only $17$ Quadratic Mixed
Linear (QML) instances. In the call for instances, no specific formats
requirements were imposed for the submissions.

To evaluate the instances we decided, for practical reasons, to use
GAMS as common platform for all the experiments involving commercial and
non-commercial solvers. For this reason, we decided to translate all
instances into the GAMS format (\texttt{.gms}). 
% In a preliminary phase, all the instances received were divided
%according to their format and subsequently translated.
%In \S~\ref{subsec:tools}
%%~\ref{subsec:CP_convex}
%the tools used
%to translate an instance from a given format to the \texttt{.gms} format
%%to translate an instance from and to a given format to the
%\texttt{.gms} format
%are described in more detail.\\
%
In addition, we have introduced a new, specific \texttt{.qplib} format. This
new format is capable of describing all the instances of the library in a sparse form.
In comparison to a more \emph{high level} format like \texttt{.gms}, the new
format presents two advantages: it is easier to read by a self-made parser and
it produces smaller files. See the \S~\ref{sec:format} for more details.

%\subsection{Instance Features}\label{subsec:feature}

For each instance of the starting set, we collected important characteristics
which allowed us to classify the instances into the QP categories described in
\S~\ref{sec:QPbasic}. As far as the variable types are concerned, we
collected the following information:
%
\begin{itemize}
 \item number of binary variables; % (\emph{\# bin}),
 %
 \item number of integer variables; % (\emph{\# int}),
 %
 \item number of continuous variables. % (\emph{\# cont}).
\end{itemize}
%
In case at least one binary or integer variable is present, then the instance is
categorized as \emph{discrete}, otherwise it is categorized as \emph{continuous}.
As fas as the objective function is concerned, we gathered the following
information:
%
\begin{itemize}
 \item percentage of negative eigenvalues of the $Q^0$ matrix;
       % (\emph{\% neg eig}),
 %
 \item density of the $Q^0$ matrix (number of nonzero entries over the total
       number). %(\emph{\% dens}).
\end{itemize}
%
The number of negative eigenvalues of $Q^0$ allows us to identify the
objective function type, as in presence of at least one negative eigenvalue
the objective function is non convex. Finally, as far as the constraint types
are concerned, we collected the following information:
%
\begin{itemize}
 \item number of linear constraints, % (\emph{\# lin}),
 %
 \item number of quadratic constraints, % (\emph{\# quad}),
 %
 \item number of convex constraints, % (\emph{\# conv}),
 %
 \item number of box constraints. %(\emph{\# box}).
\end{itemize}
%
A constraint is considered quadratic if it contains at least one nonzero in
the quadratic term. Among the quadratic constraints, the ones with only
non-negative eigenvalues are classified as convex constraints. All this
information allowed us to analyze the gathered instances and to perform the
filters described in the the next paragraph.

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Instance Selection}\label{subsec:selection}

During the development of the library, a discussion ensued about what
the expected gols that we wanted to achieve. The following four goals
where finally identified:
%
\begin{enumerate}
 \item represent as much as possible all the different categories of QP
       problems;
 %
 \item gather ``challenging'' instances, i.e., ones which can not be easily
       solved by  state-of-the-art solvers;
 %
 \item include for each of the categories a set of well-diversified
       instances;
 %
 \item obtain a set of instances which is neither too small, so as to
       preserve statistical relevance, nor too large so as to being
       computationally manageable.
\end{enumerate}
%
To achieve the aforementioned goals, we performed the following two
filters, applied in cascade.
%
\begin{itemize}
 \item \emph{First Instances Filter.}\\
       The first filter was designed to drastically reduce the number of
       instances by eliminating the ``easy'' ones. An empirical measure
       for the hardness of an instance is the CPU time needed by a
       complete solver (cf.~\S~\ref{sec:algo}) to solve it to
       global optimality. Accordingly, for each of the gathered instance we
       ran the complete solvers in {\tt GAMS} (cf.~Table \ref{t:solvers})
       capable of solving it, whose number depends on the category of the
       instance under consideration. We then filtered according to a relative
       measure of computational difficulty, i.e., we discarded all instances
       that are solved by at least 30\% of the complete solvers within a time
       limit of 30 seconds.
 %
 \item \emph{Second Instances Filter.}\\
       The goal of the second filter was to eliminate ``similar'' instances.
       We carefully analysed the instances one by one, and we clustered them
       according to their features; for each cluster we kept only a few
       representatives. {\bf Comment: we may want to be a tad more specific
       about what ``features'' exactly meant there}. Finally, in order to only
       keep computationally challenging instances we ran a general purpose solver
       able to tackle all QP categories with a time limit of 120 seconds; all the
       instances which have been solved to proven optimality within this time limit
       were discarded. {\bf Comment: this might actually be best characterized as
       a third filter.}
\end{itemize}
%
In Table~\ref{tab:filters} we summarize the two filter steps, which
allowed us to identify the final set of $251$ discrete instances and
$116$ continuous instances.

\begin{center}
\begin{table}[]
 \centering
 \setlength{\tabcolsep}{5pt}
%  \arraystretch{1}
\begin{tabular}{cccc}
Starting set& \multicolumn{ 2}{c}{ $\approx$ 8500 Instances }& \\
& \multicolumn{ 2}{c}{$\Downarrow$}& \\
& $\approx$ 6000 Discr. Inst.  & $\approx$ 2500 Cont. inst. & \\
First Filter  & $\Downarrow$  & $\Downarrow$ & \\
 & $\approx$ 3000 Discr. Inst.  & $\approx$ 1000 Cont. Inst. & \\
Second Filter & $\Downarrow$  & $\Downarrow$  & \\
% & 600 Discr. Inst.  & 250  Cont. inst. & \\
  & 251 Discr. Inst.  & 116  Cont. inst. & \\
\end{tabular}
%\begin{center}\end{center}
\caption{Instance filter steps} \label{tab:filters}
\end{table}
\end{center}

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Analysis of the final set of instances}\label{subsec:final set}

We now analyse the features of the instances selected to be part of the
library. The characteristics of the instances are presented in Table
\ref{tab:DD} for \emph{discrete} instances (*\{B,M,I,G\}*) and in Table
\ref{tab:CC} for \emph{continuous} ones (*C*). For each category, the Tables
report in column $\#$ the corresponding number of instances. It can be seen
that the final set well respects the original distribution of the gathered
instances among the different categories. Indeed, the discrete categories
(LMQ) or (QBL) are well represented by $118$ and $59$ instances,
respectively. Similarly, the continuous categories (LCQ) and (QCQ) are well
represented by $50$ and $17$ instances, respectively. Moreover, the library
actually covers the large majority of all possible categories of instances.

\begin{center}
\begin{table}
 \centering
 %\scriptsize
 \setlength{\tabcolsep}{18pt}
 \renewcommand \arraystretch{1.1}
\begin{tabular}{lllr}
\toprule
Obj. Fun. & Variables & Constraints & \#\\
\cmidrule(lr){1-4}
%
\multirow{5}*{Linear}
          & \multirow{1}*{Binary}
%                    & None      &   \\
%          &         & Linear    &  \\
                    & Quadratic &   9 \\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{2}*{Mixed}
                    & Convex    &   2\\[1.2 ex]
          &         & Quadratic &    118\\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{1}*{Integer}
%                    & Linear    &    \\
                   & Quadratic &    2\\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{1}*{General}
%                    & Linear    &    \\
                   & Quadratic &    3\\[1.2 ex]
\cmidrule(lr){1-4}
%\multirow{5}*{Linear}
%          & Binary  & Quadratic &   9\\
%          & \multirow{2}*{Mixed}
%                    & Convex    &   2\\
%          &         & Quadratic &  118\\
%%          & \multirow{2}*{Integer}
%%                    & Convex    &  15 \\
%%          &         & Quadratic &   5 \\
%          & {General} & Quadratic &   3 \\
%\hline
\multirow{3}*{Convex}
          & Binary  & Linear    &  2 \\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{2}*{Mixed}
                    & Linear    &   13\\[1.2 ex]
          &         & Quadratic &    1\\[1.2 ex]
%          & General & Linear    &    \\
%\hline
\cmidrule(lr){1-4}
\multirow{7}*{Quadratic}
          & \multirow{3}*{Binary}
                    & None      &   23\\[1.2 ex]
          &         & Linear    &  59\\[1.2 ex]
          &         & Quadratic &   5 \\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{2}*{Mixed}
                    & Linear    &   10\\[1.2 ex]
          &         & Quadratic &    1\\[1.2 ex]
%          & Integer & Linear    &    \\
\cmidrule(lr){2-4}
          & \multirow{1}*{Integer}
                    & Linear    &    2\\[1.2 ex]
\cmidrule(lr){2-4}
          & \multirow{1}*{General}
                    & Quadratic    &    1\\[1.2 ex]
%          &         & Quadratic &    \\
\hline
Total     &         &           & 251\\
%
\bottomrule
\end{tabular}
\caption{Classification of the final set of discrete instances}
\label{tab:DD}
\end{table}
\end{center}

\begin{center}
\begin{table}
 \centering
 %\scriptsize
 \setlength{\tabcolsep}{18pt}
 \renewcommand \arraystretch{1.1}
\begin{tabular}{llr}
\toprule
Obj. Fun. & Constraints & \#\\
\cmidrule(lr){1-3}
%
\multirow{2}*{Linear}    & Convex    &   11\\[1.2 ex]
                         & Quadratic &   50\\[1.2 ex]
\cmidrule(lr){1-3}
\multirow{4}*{Convex}
                         & Box       &   3 \\[1.2 ex]
                         & Linear    &   12\\[1.2 ex]
                         & Convex    &    2\\[1.2 ex]
                         & Quadratic &    5\\[1.2 ex]
\cmidrule(lr){1-3}
\multirow{3}*{Quadratic}
                         & Linear    &   5\\[1.2 ex]
                         & Convex    &   11\\[1.2 ex]
                         & Quadratic &   17\\[1.2 ex]
\hline
Total                    &           & 116 \\
%
\bottomrule
\end{tabular}
\caption{Classification of the final set of continuous instances}
\label{tab:CC}
\end{table}
\end{center}

We now report some graphs that help in illustrating the main features
of the instences. In Figure~\ref{fig:distribution} we plot the number
of variables (horizontal axis) versus the number of constrains
(vertical axis), both in logarithmic scale. Continuous instances are
marked with ``$+$'', and discrete ones with ``$\times$''. The figure shows
that the library contains a quite diverse set of instances of different in
terms of number of variables and constraints. The number of constraints goes
from few units up to one hundred thousands constraints, while the number of
variables goes up to almost forty-five thousands.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_overview.png}
  \caption{Distribution of variables and constrains  of the qplib
instances \label{fig:distribution}}
\end{figure}

%Figure~\ref{fig:pic_var_small}, Figure~\ref{fig:pic_var_medium} and
Figure~\ref{fig:pic_var} 
describes how discrete and continuous
variables are distributed within the instances. The instances are
sorted accordingly to the total number of variables.
% and, for reason of
%readability, the graph is splitted in the three figures:
%Figure~\ref{fig:pic_var_small} describes the 100 smaller instances,
%Figure~\ref{fig:pic_var_medium} the 200 medium ones, and
%Figure~\ref{fig:pic_var_large} the 67 largest ones. 
For each instance we report the total number of variables with a ``$+$'', and the total number of discrete variables (binary or general integer) with a ``$\times$''. The pictures clearly show that instances with different percentages of integer and continuous variables are present in the library, and well distributed across the whole spectrum of variable sizes.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_var.png}
  \caption{Number of variables \label{fig:pic_var}}
\end{figure}

%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_var_small.png}
%  \caption{Number of variables (a) \label{fig:pic_var_small}}
%\end{figure}
%
%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_var_medium.png}
%  \caption{Number of variables (b) \label{fig:pic_var_medium}}
%\end{figure}
%
%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_var_big.png}
%  \caption{Number of variables (c) \label{fig:pic_var_large}}
%\end{figure}

Similarly, Figures~\ref{fig:pic_constr} 
%Figure~\ref{fig:pic_constr_medium}
%and Figure~\ref{fig:pic_constr_big} 
describes how linear and quadratic
constraints are distributed within the instances. The instances are sorted
accordingly to the total number of constraints
% and divided in the same manner as for Figures~\ref{fig:pic_var_small}--\ref{fig:pic_var_large}.
For each instances we report the total number of constraints with a ``$+$''
and the total number of (either convex of nonconvex) quadratic constraints
with a ``$\times$''. Also in this case, different percentages of linear and
quadratic constraints are present and well-distributed across the spectrum
of constraint sizes, although both medium- and large-size instances show a
prevalence of lower percentages of quadratic constraints. In particular,
from Figure~\ref{fig:pic_constr} we learn that while the maximum number
of linear constraints exceeds 100000, the maximum number of quadratic
constraints tops up at around 10000. This is, however, reasonable, considering
how quadratic constraints can, in general, be expected to be much more
computationally challenging than linear ones, especially if nonconvex.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_constr.png}
  \caption{Number of constraints \label{fig:pic_constr}}
\end{figure}

%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_constr_small.png}
%  \caption{Number of constraints (a) \label{fig:pic_constr_small}}
%\end{figure}
%
%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_constr_medium.png}
%  \caption{Number of constraints (b) \label{fig:pic_constr_medium}}
%\end{figure}
%
%\begin{figure}\centering
%  \includegraphics[width=0.85\textwidth]{pic_constr_big.png}
%  \caption{Number of constraints (c) \label{fig:pic_constr_big}}
%\end{figure}

Figure~\ref{fig:pic_conv_constr} shows the instances with at least a quadratic constraints sorted according to the number of quadratic constraints (vertical axis). For each instances we report the total number of constraints with a ``$+$''
and the total number of nonconvex quadratic constraints
with a ``$\times$''.

\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_quad_conv_vs_nonconv.png}
  \caption{Quadratic constraints \label{fig:pic_conv_constr}}
\end{figure}





Speaking of nonconvexity, Figure~\ref{fig:pic_neg_eig} focuses on
the instances with a quadratic objective function, ordered by the
the percentage of negative eigenvalues (vertical axis). Although
almost all percentages are represented, the instances are mostly
clustered around two values. About 25\% of the instances are convex,
i.e., they have 0\% of negative eigenvalues. Among the others, a vast
majority have around 50\% of negative eigenvalues. However, instances
with high or low percentages of negative eigenvalues are present.

\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_neg_eig.png}
  \caption{Negative eigenvalues \label{fig:pic_neg_eig}}
\end{figure}

Similarly, Figure~\ref{fig:pic_density} shows the instances with a
quadratic objective function sorted according to the density of the
$Q^0$ matrix (vertical axis). The majority of the instances have either
a very low or a rather high density: indeed, about 30\% of the instances
have density smaller that 5\%, and about 30\% of the instances have
density larger that 50\%. However, also intermediate values are present. 

\begin{figure}\centering
  \includegraphics[width=0.85\textwidth]{pic_density.png}
  \caption{Density \label{fig:pic_density}}
\end{figure}


Additional details on the instance features can be found in \S~\ref{sec:instance_details}.
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%  End QPLIB-3.tex
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
